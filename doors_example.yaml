# ==============================================================================
#  UNIFI ACCESS DOOR MANAGER - CONFIGURATION v1.14.0
# ==============================================================================
#  INSTRUCTIONS:
#  1. Place this file in /config/pyscript/
#  2. Rename it to 'doors.yaml'.
#  3. Update the entities below to match your Home Assistant setup.
#  4. Restart Home Assistant to apply changes.
# ==============================================================================

Settings:
  # [REQUIRED] MASTER PAUSE TOGGLE
  # Turn ON to stop the automation (Maintenance/Holiday).
  pause_entity: input_boolean.pause_door_schedule

  # [OPTIONAL] PHYSICAL LOCKDOWN SWITCH
  # Turn ON to immediately lock all doors and ignore schedule.
  lockdown_switch: switch.all_doors_lockdown

  # [OPTIONAL] GLOBAL MASTER KEY
  # If an event title contains this text, ALL doors unlock.
  # Option A: Use a Helper (Flexible)
  global_keyword_helper: input_text.global_door_keyword
  # Option B: Hardcoded Text (Simple) - Uncomment to use
  # global_keyword_helper: "ALL"

  # [REQUIRED] SYSTEM MEMORY
  # Stores state to prevent notification spam.
  memory_entity: input_text.door_manager_memory

  # NIGHT MODE (THE BOUNCER)
  # When does the building CLOSE (Lockdown Start) and OPEN (Lockdown End)?
  
  # OPTION A: Use Dashboard Helpers (Adjustable from Phone)
  # night_mode_start: input_datetime.night_mode_start
  # night_mode_end: input_datetime.night_mode_end

  # OPTION B: Hardcoded Text (Set and Forget)
  night_mode_start: "11:00 PM"
  night_mode_end: "6:00 AM"

  # [OPTIONAL] DEBUGGING
  # Set to true to see logs in Settings > System > Logs.
  debug_logging: true

# ==============================================================================
#  DEFAULTS (Global Rules)
# ==============================================================================
#  These settings apply to ALL doors unless specifically overridden below.
# ==============================================================================
Defaults:
  # Default Buffers (Minutes)
  # Pre: Unlock BEFORE event. Post: Lock AFTER event.
  pre_buffer: 15
  post_buffer: 15
  
  # Default Notification Service
  # The phone that gets the alerts (e.g., notify.mobile_app_iphone).
  notification_service: notify.mobile_app_your_phone

# ==============================================================================
#  DOOR CONFIGURATION
# ==============================================================================

# EXAMPLE 1: THE "HYBRID" DOOR (Most Common)
# Uses Dashboard Helpers for settings you change often, but keeps the rest simple.
Front Door:
  entity: lock.front_door
  reset_entity: select.front_door_lock_rule
  calendar: calendar.office_schedule
  
  # KEYWORD CONFIGURATION (Choose One)
  # Option A: Dashboard Helper
  keyword_helper: input_text.door_keyword
  # Option B: Hardcoded Text
  # keyword: "D1"
  
  # BUFFER CONFIGURATION (Choose One)
  # Option A: Dashboard Sliders
  pre_buffer: input_number.front_door_pre_buffer
  post_buffer: input_number.front_door_post_buffer
  # Option B: Hardcoded Minutes
  # pre_buffer: 15
  # post_buffer: 15
  
  # NOTIFICATIONS: 'summary' (once per day) or 'all' (every unlock)
  # NOTE: Conflict alerts and night verification ALWAYS send regardless of this setting
  notify_type: summary
  
  # [OPTIONAL] Override notification service for this door only
  # Useful if you want critical doors to alert a different person
  # notification_service: notify.mobile_app_manager_phone


# EXAMPLE 2: THE "SIMPLE" DOOR (Hardcoded)
# No helpers needed. Just set the values here and forget it.
# ------------------------------------------------------------------------------
# Warehouse:
#   entity: lock.warehouse_door
#   reset_entity: select.warehouse_rule
#   calendar: calendar.warehouse_schedule
#   keyword: "WH"         # Hardcoded keyword
#   notify_type: all      # Get notified every time it unlocks/locks
#   # Buffers use Defaults (15/15) unless you add them here:
#   # pre_buffer: 30
#   # post_buffer: 30


# EXAMPLE 3: THE "STRICT" DOOR (Zero Buffer)
# Overrides defaults for exact timing.
# ------------------------------------------------------------------------------
# Server Room:
#   entity: lock.server_room
#   reset_entity: select.server_rule
#   calendar: calendar.it_schedule
#   keyword: "SERVER"
#   pre_buffer: 0
#   post_buffer: 0
#   notify_type: summary
#   notification_service: notify.it_admin_phone


# ==============================================================================
#  NOTIFICATION BEHAVIOR EXPLAINED
# ==============================================================================
#
#  The new v1.14.0 code sends THREE types of notifications:
#
#  1. ðŸš¨ CONFLICT ALERTS (Always sent, regardless of notify_type)
#     - Sent immediately when a scheduling conflict is detected
#     - Could be days in advance
#     - Sent once per conflicting event
#
#  2. â° 10-MINUTE WARNING (Always sent, regardless of notify_type)
#     - Sent 10 minutes before night mode if there's an active conflict
#     - Sent once per day
#
#  3. ðŸŒ™ NIGHT VERIFICATION (Always sent to DEFAULT notification service)
#     - Sent when night mode starts (e.g., 11:00 PM)
#     - Reports which doors are unlocked
#     - Sent once per day
#
#  4. ðŸ”“ UNLOCK/LOCK NOTIFICATIONS (Respects notify_type setting)
#     - notify_type: 'summary' = First unlock of the day only
#     - notify_type: 'all' = Every unlock and lock event
#
# ==============================================================================


# ==============================================================================
#  REQUIRED HOME ASSISTANT HELPERS
# ==============================================================================
#
#  You need to create these in Settings > Devices & Services > Helpers:
#
#  1. input_boolean.pause_door_schedule
#     - Type: Toggle
#     - Name: "Pause Door Schedule"
#
#  2. input_text.door_manager_memory
#     - Type: Text
#     - Name: "Door Manager Memory"
#     - Max length: 4096 or higher
#
#  3. (Optional) input_text.global_door_keyword
#     - Type: Text
#     - Name: "Global Door Keyword"
#
#  4. (Optional) input_datetime.night_mode_start
#     - Type: Date and/or time (Time only)
#     - Name: "Night Mode Start"
#
#  5. (Optional) input_datetime.night_mode_end
#     - Type: Date and/or time (Time only)
#     - Name: "Night Mode End"
#
#  6. (Optional) Per-door helpers like:
#     - input_text.door_keyword
#     - input_number.front_door_pre_buffer (min: 0, max: 120, step: 5)
#     - input_number.front_door_post_buffer (min: 0, max: 120, step: 5)
#
# ==============================================================================
